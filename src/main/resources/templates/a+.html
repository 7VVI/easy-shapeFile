<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸºçº¿å‡ ä½•è®¡ç®—åŸç†</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        canvas {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            display: block;
            margin: 20px auto;
            background: #fafafa;
            cursor: crosshair;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .control-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 13px;
        }
        input[type="range"] {
            width: 100%;
            margin: 5px 0;
        }
        input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .value-display {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 5px;
        }
        .explanation {
            background: #f0f7ff;
            border-left: 4px solid #2196F3;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .explanation h3 {
            margin-top: 0;
            color: #2196F3;
        }
        .formula {
            background: white;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            border: 1px solid #ddd;
            overflow-x: auto;
        }
        .step {
            background: #fff9e6;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .step-title {
            font-weight: bold;
            color: #f57c00;
            margin-bottom: 8px;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            border: 1px solid #333;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        button:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ“ åŸºçº¿å‡ ä½•è®¡ç®—åŸç†å›¾ç¤º</h1>
    <p class="subtitle">BaseLineTypeEnum.A ç±»å‹åŸºçº¿è‡ªåŠ¨ç”Ÿæˆç®—æ³•å¯è§†åŒ–</p>

    <canvas id="canvas" width="800" height="600"></canvas>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background: #4CAF50;"></div>
            <span>åœ°å—å¤šè¾¹å½¢</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #2196F3;"></div>
            <span>å¤–æ¥çŸ©å½¢</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9800;"></div>
            <span>å¯¹è§’çº¿ (diag)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #F44336;"></div>
            <span>åŸºçº¿ (60% diag)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #9C27B0;"></div>
            <span>è´¨å¿ƒ</span>
        </div>
    </div>

    <div class="controls">
        <div class="control-group">
            <label>
                è§’åº¦ (Angle):
                <span class="value-display" id="angleValue">45Â°</span>
            </label>
            <input type="range" id="angleSlider" min="0" max="360" value="45" step="1">
        </div>
        <div class="control-group">
            <label>
                æ¯”ä¾‹ç³»æ•°:
                <span class="value-display" id="scaleValue">0.60</span>
            </label>
            <input type="range" id="scaleSlider" min="0.1" max="1.5" value="0.6" step="0.05">
        </div>
        <div class="control-group">
            <label>åæ ‡ç‚¹æ¨¡å¼:</label>
            <select id="modeSelect" style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                <option value="0">æ— åæ ‡ (ä»è´¨å¿ƒç”Ÿæˆ)</option>
                <option value="1">å•ç‚¹ (ä»ç‚¹å»¶ä¼¸)</option>
            </select>
        </div>
    </div>

    <div class="explanation">
        <h3>ğŸ” ä»£ç é€»è¾‘è¯¦è§£</h3>

        <div class="step">
            <div class="step-title">æ­¥éª¤ 1: è§£æåœ°å—å‡ ä½•</div>
            ä» GeoJSON ä¸­è¯»å– Polygon å‡ ä½•æ•°æ®ï¼Œè·å–å¤–ç¯åæ ‡ç‚¹ï¼Œè½¬æ¢ä¸º JTS Coordinate æ•°ç»„ã€‚
            <div class="formula">
                Coordinate[] shell = new Coordinate[ext.size()];
                for (int i = 0; i < ext.size(); i++) {
                shell[i] = new Coordinate(lng, lat);
                }</div>
        </div>

        <div class="step">
            <div class="step-title">æ­¥éª¤ 2: é—­åˆå¤šè¾¹å½¢</div>
            ç¡®ä¿é¦–å°¾ç‚¹ç›¸åŒï¼ˆå¤šè¾¹å½¢é—­åˆæ¡ä»¶ï¼‰ï¼Œè‹¥ä¸ç›¸åŒåˆ™æ·»åŠ é¦–ç‚¹åˆ°æœ«å°¾ã€‚
            <div class="formula">
                if (!shell[0].equals2D(shell[shell.length - 1])) {
                shell = Arrays.copyOf(shell, shell.length + 1);
                shell[shell.length - 1] = shell[0];
                }</div>
        </div>

        <div class="step">
            <div class="step-title">æ­¥éª¤ 3: è®¡ç®—å¤–æ¥çŸ©å½¢å¯¹è§’çº¿</div>
            è·å–å¤šè¾¹å½¢çš„å¤–æ¥çŸ©å½¢ï¼ˆEnvelopeï¼‰ï¼Œè®¡ç®—å…¶å¯¹è§’çº¿é•¿åº¦ã€‚
            <div class="formula">
                width = env.getWidth();
                height = env.getHeight();
                diag = âˆš(widthÂ² + heightÂ²)  // å‹¾è‚¡å®šç†</div>
        </div>

        <div class="step">
            <div class="step-title">æ­¥éª¤ 4: ç¡®å®šåŸºçº¿é•¿åº¦</div>
            åŸºçº¿é•¿åº¦ä¸ºå¯¹è§’çº¿çš„ 60%ï¼ˆå¯è°ƒæ•´æ¯”ä¾‹ç³»æ•°ï¼‰ã€‚
            <div class="formula">
                half = diag Ã— 0.6  // åŠé•¿ = å¯¹è§’çº¿ Ã— 60%
                åŸºçº¿æ€»é•¿ = 2 Ã— half = diag Ã— 1.2</div>
        </div>

        <div class="step">
            <div class="step-title">æ­¥éª¤ 5: è§’åº¦è½¬å‘é‡</div>
            å°†è§’åº¦ï¼ˆåº¦ï¼‰è½¬æ¢ä¸ºå¼§åº¦ï¼Œå¹¶è®¡ç®— X/Y æ–¹å‘çš„åç§»é‡ã€‚
            <div class="formula">
                rad = angle Ã— (Ï€ / 180)  // è§’åº¦è½¬å¼§åº¦
                dx = sin(rad) Ã— half     // Xæ–¹å‘åç§»
                dy = cos(rad) Ã— half     // Yæ–¹å‘åç§»</div>
        </div>

        <div class="step">
            <div class="step-title">æ­¥éª¤ 6: ç”ŸæˆåŸºçº¿åæ ‡</div>
            <strong>æƒ…å†µ A (coords.size() == 1):</strong> ä»å·²æœ‰ç‚¹å»¶ä¼¸
            <div class="formula">
                èµ·ç‚¹ = coords[0]
                ç»ˆç‚¹ = (èµ·ç‚¹.x + dx, èµ·ç‚¹.y + dy)</div>

            <strong>æƒ…å†µ B (coords.size() == 0):</strong> ä»è´¨å¿ƒä¸¤ä¾§ç”Ÿæˆ
            <div class="formula">
                è´¨å¿ƒ = poly.getCentroid()
                èµ·ç‚¹ = (è´¨å¿ƒ.x - dx, è´¨å¿ƒ.y - dy)
                ç»ˆç‚¹ = (è´¨å¿ƒ.x + dx, è´¨å¿ƒ.y + dy)</div>
        </div>
    </div>

    <div class="explanation">
        <h3>ğŸ“Š æ•°å­¦åŸç†</h3>
        <p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨ sin/cosï¼Ÿ</strong></p>
        <p>åœ¨äºŒç»´å¹³é¢ä¸­ï¼Œä»ä¸€ä¸ªç‚¹æ²¿ç‰¹å®šè§’åº¦ç§»åŠ¨è·ç¦» rï¼š</p>
        <div class="formula">
            â€¢ X åç§» = r Ã— sin(Î¸)  // æ°´å¹³æ–¹å‘
            â€¢ Y åç§» = r Ã— cos(Î¸)  // å‚ç›´æ–¹å‘
        </div>
        <p>æ³¨æ„ï¼šè¿™é‡Œ Î¸=0Â° è¡¨ç¤ºæ­£åŒ—æ–¹å‘ï¼ˆYè½´æ­£å‘ï¼‰ï¼Œé¡ºæ—¶é’ˆæ—‹è½¬ä¸ºæ­£ã€‚</p>

        <p><strong>ä¸ºä»€ä¹ˆé€‰æ‹© 60% å¯¹è§’çº¿ï¼Ÿ</strong></p>
        <p>â€¢ ç¡®ä¿åŸºçº¿é•¿åº¦é€‚ä¸­ï¼Œä¸ä¼šè¿‡çŸ­æˆ–è¶…å‡ºåœ°å—èŒƒå›´<br>
            â€¢ å¯¹è§’çº¿ä»£è¡¨åœ°å—æœ€å¤§è·¨åº¦ï¼Œå– 60% æ˜¯ç»éªŒå€¼<br>
            â€¢ å¯æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´æ­¤ç³»æ•°ï¼ˆå¦‚ 0.5~0.8ï¼‰</p>
    </div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const angleSlider = document.getElementById('angleSlider');
    const scaleSlider = document.getElementById('scaleSlider');
    const modeSelect = document.getElementById('modeSelect');
    const angleValue = document.getElementById('angleValue');
    const scaleValue = document.getElementById('scaleValue');

    // å¤šè¾¹å½¢é¡¶ç‚¹ï¼ˆç›¸å¯¹åæ ‡ï¼‰
    const polygonPoints = [
        [150, 100], [450, 80], [500, 300], [400, 450], [200, 420], [100, 250]
    ];

    let startPoint = null;

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const angle = parseFloat(angleSlider.value);
        const scale = parseFloat(scaleSlider.value);
        const mode = parseInt(modeSelect.value);

        angleValue.textContent = angle + 'Â°';
        scaleValue.textContent = scale.toFixed(2);

        // 1. ç»˜åˆ¶å¤šè¾¹å½¢
        ctx.beginPath();
        ctx.moveTo(polygonPoints[0][0], polygonPoints[0][1]);
        for (let i = 1; i < polygonPoints.length; i++) {
            ctx.lineTo(polygonPoints[i][0], polygonPoints[i][1]);
        }
        ctx.closePath();
        ctx.fillStyle = 'rgba(76, 175, 80, 0.2)';
        ctx.fill();
        ctx.strokeStyle = '#4CAF50';
        ctx.lineWidth = 2;
        ctx.stroke();

        // 2. è®¡ç®—è¾¹ç•Œæ¡†
        let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
        polygonPoints.forEach(p => {
            minX = Math.min(minX, p[0]);
            minY = Math.min(minY, p[1]);
            maxX = Math.max(maxX, p[0]);
            maxY = Math.max(maxY, p[1]);
        });

        const width = maxX - minX;
        const height = maxY - minY;

        // ç»˜åˆ¶å¤–æ¥çŸ©å½¢
        ctx.strokeStyle = '#2196F3';
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]);
        ctx.strokeRect(minX, minY, width, height);
        ctx.setLineDash([]);

        // ç»˜åˆ¶å¯¹è§’çº¿
        ctx.strokeStyle = '#FF9800';
        ctx.lineWidth = 1;
        ctx.setLineDash([3, 3]);
        ctx.beginPath();
        ctx.moveTo(minX, minY);
        ctx.lineTo(maxX, maxY);
        ctx.stroke();
        ctx.setLineDash([]);

        // 3. è®¡ç®—å¯¹è§’çº¿é•¿åº¦
        const diag = Math.sqrt(width * width + height * height);
        const half = diag * scale;

        // 4. è®¡ç®—è´¨å¿ƒ
        const centroidX = polygonPoints.reduce((sum, p) => sum + p[0], 0) / polygonPoints.length;
        const centroidY = polygonPoints.reduce((sum, p) => sum + p[1], 0) / polygonPoints.length;

        // ç»˜åˆ¶è´¨å¿ƒ
        ctx.fillStyle = '#9C27B0';
        ctx.beginPath();
        ctx.arc(centroidX, centroidY, 6, 0, Math.PI * 2);
        ctx.fill();

        // 5. è®¡ç®—åç§»
        const rad = angle * Math.PI / 180;
        const dx = Math.sin(rad) * half;
        const dy = Math.cos(rad) * half;

        // 6. æ ¹æ®æ¨¡å¼ç»˜åˆ¶åŸºçº¿
        let x0, y0, x1, y1;

        if (mode === 1 && startPoint) {
            // ä»å•ç‚¹å»¶ä¼¸
            x0 = startPoint[0];
            y0 = startPoint[1];
            x1 = x0 + dx;
            y1 = y0 + dy;

            // ç»˜åˆ¶èµ·ç‚¹
            ctx.fillStyle = '#FF5722';
            ctx.beginPath();
            ctx.arc(x0, y0, 5, 0, Math.PI * 2);
            ctx.fill();
        } else {
            // ä»è´¨å¿ƒä¸¤ä¾§
            x0 = centroidX - dx;
            y0 = centroidY - dy;
            x1 = centroidX + dx;
            y1 = centroidY + dy;
        }

        // ç»˜åˆ¶åŸºçº¿
        ctx.strokeStyle = '#F44336';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(x0, y0);
        ctx.lineTo(x1, y1);
        ctx.stroke();

        // ç»˜åˆ¶åŸºçº¿ç«¯ç‚¹
        ctx.fillStyle = '#F44336';
        ctx.beginPath();
        ctx.arc(x0, y0, 5, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.arc(x1, y1, 5, 0, Math.PI * 2);
        ctx.fill();

        // ç»˜åˆ¶æ–¹å‘ç®­å¤´
        const arrowLen = 15;
        const arrowAngle = Math.PI / 6;
        const lineAngle = Math.atan2(y1 - y0, x1 - x0);

        ctx.strokeStyle = '#F44336';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(
            x1 - arrowLen * Math.cos(lineAngle - arrowAngle),
            y1 - arrowLen * Math.sin(lineAngle - arrowAngle)
        );
        ctx.moveTo(x1, y1);
        ctx.lineTo(
            x1 - arrowLen * Math.cos(lineAngle + arrowAngle),
            y1 - arrowLen * Math.sin(lineAngle + arrowAngle)
        );
        ctx.stroke();

        // æ ‡æ³¨
        ctx.fillStyle = '#333';
        ctx.font = '12px Arial';
        ctx.fillText(`å¯¹è§’çº¿: ${diag.toFixed(1)}px`, minX, minY - 10);
        ctx.fillText(`åŸºçº¿é•¿: ${(half * 2).toFixed(1)}px`, (x0 + x1) / 2 + 10, (y0 + y1) / 2 - 10);
        ctx.fillText(`è§’åº¦: ${angle}Â°`, x1 + 10, y1);
    }

    canvas.addEventListener('click', (e) => {
        if (parseInt(modeSelect.value) === 1) {
            const rect = canvas.getBoundingClientRect();
            startPoint = [e.clientX - rect.left, e.clientY - rect.top];
            draw();
        }
    });

    angleSlider.addEventListener('input', draw);
    scaleSlider.addEventListener('input', draw);
    modeSelect.addEventListener('change', () => {
        startPoint = null;
        draw();
    });

    draw();
</script>
</body>
</html>